@{
    ViewData["Title"] = "Activity Analytics";
}

<section class="analytics-section">
    <div class="container-fluid px-4">
        <!-- Page Header -->
        <div class="admin-page-header animate-fade-in">
            <a asp-action="Index" class="back-link">
                <i class="bi bi-arrow-left"></i> Back to Analytics
            </a>
            <h1 class="admin-page-title">
                <i class="bi bi-activity"></i> Activity Analytics
            </h1>
            <p class="admin-page-subtitle">Peak hours, active days, and platform activity insights</p>
        </div>

        <!-- Peak Stats -->
        <div class="row g-4 mb-4">
            <div class="col-lg-6">
                <div class="stat-card large animate-fade-in">
                    <div class="stat-icon active">
                        <i class="bi bi-clock"></i>
                    </div>
                    <div class="stat-content">
                        <h3 class="stat-number">@ViewBag.PeakHour:00</h3>
                        <p class="stat-label">Peak Activity Hour</p>
                        <small class="text-muted">Most notes are created at this hour</small>
                    </div>
                </div>
            </div>
            <div class="col-lg-6">
                <div class="stat-card large animate-fade-in">
                    <div class="stat-icon notes">
                        <i class="bi bi-calendar-day"></i>
                    </div>
                    <div class="stat-content">
                        <h3 class="stat-number">@ViewBag.MostActiveDay</h3>
                        <p class="stat-label">Most Active Day</p>
                        <small class="text-muted">Highest note creation activity</small>
                    </div>
                </div>
            </div>
        </div>

        <div class="row g-4">
            <!-- Hourly Activity -->
            <div class="col-lg-6">
                <div class="dashboard-card animate-fade-in">
                    <div class="card-header">
                        <h5><i class="bi bi-clock-history"></i> Activity by Hour</h5>
                    </div>
                    <div class="card-body">
                        @if (ViewBag.HourlyActivity != null && ((IEnumerable<dynamic>)ViewBag.HourlyActivity).Any())
                        {
                            <div class="hourly-grid">
                                @{
                                    var maxHourly = ((IEnumerable<dynamic>)ViewBag.HourlyActivity).Max(x => (int)x.Count);
                                    var hourlyDict = ((IEnumerable<dynamic>)ViewBag.HourlyActivity).ToDictionary(x => (int)x.Hour, x => (int)x.Count);
                                }
                                @for (int h = 0; h < 24; h++)
                                {
                                    var count = hourlyDict.ContainsKey(h) ? hourlyDict[h] : 0;
                                    var intensity = maxHourly > 0 ? (count * 100 / maxHourly) : 0;
                                    <div class="hour-cell" style="--intensity: @intensity%" title="@h:00 - @count notes">
                                        <span class="hour-label">@h</span>
                                    </div>
                                }
                            </div>
                            <div class="hour-legend mt-3">
                                <span><i class="bi bi-square-fill" style="color: #E0E0E0;"></i> Low</span>
                                <span><i class="bi bi-square-fill" style="color: #81C784;"></i> Medium</span>
                                <span><i class="bi bi-square-fill" style="color: #4CAF50;"></i> High</span>
                            </div>
                        }
                        else
                        {
                            <p class="text-muted text-center">No hourly activity data available.</p>
                        }
                    </div>
                </div>
            </div>

            <!-- Weekly Activity -->
            <div class="col-lg-6">
                <div class="dashboard-card animate-fade-in">
                    <div class="card-header">
                        <h5><i class="bi bi-calendar-week"></i> Activity by Weekday</h5>
                    </div>
                    <div class="card-body">
                        @if (ViewBag.WeekdayActivity != null && ((IEnumerable<dynamic>)ViewBag.WeekdayActivity).Any())
                        {
                            <div class="weekday-bars">
                                @{
                                    var maxWeekday = ((IEnumerable<dynamic>)ViewBag.WeekdayActivity).Max(x => (int)x.Count);
                                    var weekdayDict = ((IEnumerable<dynamic>)ViewBag.WeekdayActivity).ToDictionary(x => x.DayOfWeek, x => (int)x.Count);
                                    var days = new[] { DayOfWeek.Sunday, DayOfWeek.Monday, DayOfWeek.Tuesday, DayOfWeek.Wednesday, DayOfWeek.Thursday, DayOfWeek.Friday, DayOfWeek.Saturday };
                                }
                                @foreach (var day in days)
                                {
                                    var count = weekdayDict.ContainsKey(day) ? weekdayDict[day] : 0;
                                    var width = maxWeekday > 0 ? (count * 100 / maxWeekday) : 0;
                                    <div class="weekday-bar-item">
                                        <span class="day-name">@day.ToString().Substring(0, 3)</span>
                                        <div class="bar-container">
                                            <div class="bar-fill" style="width: @width%"></div>
                                        </div>
                                        <span class="day-count">@count</span>
                                    </div>
                                }
                            </div>
                        }
                        else
                        {
                            <p class="text-muted text-center">No weekday activity data available.</p>
                        }
                    </div>
                </div>
            </div>

            <!-- Recent Activity Timeline -->
            <div class="col-12">
                <div class="dashboard-card animate-fade-in">
                    <div class="card-header">
                        <h5><i class="bi bi-clock-history"></i> Recent Activity Timeline</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <!-- Recent Notes -->
                            <div class="col-md-6">
                                <h6 class="timeline-title"><i class="bi bi-journal-text"></i> Recent Notes</h6>
                                @if (ViewBag.RecentNotes != null && ((IEnumerable<dynamic>)ViewBag.RecentNotes).Any())
                                {
                                    <div class="timeline-list">
                                        @foreach (var note in ((IEnumerable<dynamic>)ViewBag.RecentNotes).Take(10))
                                        {
                                            var noteDate = ((DateTime)note.CreatedAt).ToString("MMM dd, hh:mm tt");
                                            <div class="timeline-item">
                                                <div class="timeline-icon notes">
                                                    <i class="bi bi-journal"></i>
                                                </div>
                                                <div class="timeline-content">
                                                    <p>@note.Title</p>
                                                    <small>by @note.UserName â€¢ @noteDate</small>
                                                </div>
                                            </div>
                                        }
                                    </div>
                                }
                                else
                                {
                                    <p class="text-muted">No recent notes.</p>
                                }
                            </div>

                            <!-- Recent Users -->
                            <div class="col-md-6">
                                <h6 class="timeline-title"><i class="bi bi-people"></i> Recent Users</h6>
                                @if (ViewBag.RecentUsers != null && ((IEnumerable<dynamic>)ViewBag.RecentUsers).Any())
                                {
                                    <div class="timeline-list">
                                        @foreach (var user in ((IEnumerable<dynamic>)ViewBag.RecentUsers).Take(10))
                                        {
                                            var userDate = ((DateTime)user.CreatedAt).ToString("MMM dd, hh:mm tt");
                                            <div class="timeline-item">
                                                <div class="timeline-icon users">
                                                    <i class="bi bi-person-plus"></i>
                                                </div>
                                                <div class="timeline-content">
                                                    <p>@user.FullName</p>
                                                    <small>joined @userDate</small>
                                                </div>
                                            </div>
                                        }
                                    </div>
                                }
                                else
                                {
                                    <p class="text-muted">No recent users.</p>
                                }
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
